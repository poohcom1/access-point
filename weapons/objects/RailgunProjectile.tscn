[gd_scene load_steps=4 format=2]

[ext_resource path="res://assets/white.png" type="Texture" id=1]

[sub_resource type="GDScript" id=1]
script/source = "extends Area2D

# Properties
var pierce_count
var damage

var distance

var angle: float
var speed: float = 20

var knockback = 0

# Fields
var _direction: Vector2
var hit_targets := []

func _ready():
	# warning-ignore:return_value_discarded
	connect(\"body_entered\", self, \"on_hit\")
	_direction = Vector2(cos(angle), sin(angle)) * speed
	
func _physics_process(delta):
	damage = max(1, damage-delta*50)
	global_position += _direction

func on_hit(body: Object):
	if body is Enemy and not body in hit_targets:
		body.on_hit(damage)
		body.on_hit_knockback(_direction.normalized() * knockback)
		hit_targets.append(body)
		
		pierce_count -= 1
		if pierce_count == 0:
			on_destroy()
	elif body is TileMap:
		on_destroy()
		
func on_destroy():
	queue_free()
"

[sub_resource type="CircleShape2D" id=2]
radius = 6.67232

[node name="Projectile" type="Area2D"]
modulate = Color( 1, 0.964706, 0.0470588, 1 )
script = SubResource( 1 )

[node name="Sprite" type="Sprite" parent="."]
position = Vector2( -0.0701542, 0 )
scale = Vector2( 0.232692, 0.232692 )
texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource( 2 )
